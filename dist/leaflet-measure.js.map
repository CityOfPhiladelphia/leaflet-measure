{"version":3,"file":"leaflet-measure.js","sources":["../src/util/units.js","../src/util/dom.js","../src/util/measure.js","../src/symbology.js","../src/index.js"],"sourcesContent":["// units.js\n// Unit configurations\n// Factor is with respect to meters/sqmeters\n\nexport default {\n  acres: {\n    factor: 0.00024711,\n    display: 'acres',\n    decimals: 2\n  },\n  feet: {\n    factor: 3.2808,\n    display: 'feet',\n    decimals: 0\n  },\n  kilometers: {\n    factor: 0.001,\n    display: 'kilometers',\n    decimals: 2\n  },\n  hectares: {\n    factor: 0.0001,\n    display: 'hectares',\n    decimals: 2\n  },\n  meters: {\n    factor: 1,\n    display: 'meters',\n    decimals: 0\n  },\n  miles: {\n    factor: 3.2808 / 5280,\n    display: 'miles',\n    decimals: 2\n  },\n  sqfeet: {\n    factor: 10.7639,\n    display: 'sqfeet',\n    decimals: 0\n  },\n  sqmeters: {\n    factor: 1,\n    display: 'sqmeters',\n    decimals: 0\n  },\n  sqmiles: {\n    factor: 0.000000386102,\n    display: 'sqmiles',\n    decimals: 2\n  }\n};\n","// dom.js\n// utility functions for managing DOM elements\n\nexport function selectOne(selector, el) {\n  if (!el) {\n    el = document;\n  }\n  return el.querySelector(selector);\n}\n\nexport function selectAll(selector, el) {\n  if (!el) {\n    el = document;\n  }\n  return Array.prototype.slice.call(el.querySelectorAll(selector));\n}\n\nexport function hide(el) {\n  if (el) {\n    el.setAttribute('style', 'display:none;');\n    return el;\n  }\n}\n\nexport function show(el) {\n  if (el) {\n    el.removeAttribute('style');\n    return el;\n  }\n}\n","import { Polyline, Polygon } from 'leaflet';\nimport length from '@turf/length';\nimport area from '@turf/area';\n\n/* calc measurements for an array of points */\nexport default function measure(latlngs) {\n  const last = latlngs[latlngs.length - 1];\n  const path = latlngs.map(latlng => [latlng.lat, latlng.lng]);\n  const polyline = new Polyline(path);\n  const polygon = new Polygon(path);\n  const meters = length(polyline.toGeoJSON(), { units: 'kilometers' }) * 1000;\n  const sqMeters = area(polygon.toGeoJSON());\n\n  return {\n    length: meters,\n    area: sqMeters,\n  };\n};\n","const DEFAULT_OPTIONS = {\n  activeColor: '#ABE67E',\n  completedColor: '#C8F2BE'\n};\n\nexport default class Symbology {\n  constructor(options) {\n    this._options = L.extend({}, DEFAULT_OPTIONS, this._options, options);\n  }\n\n  getSymbol(name) {\n    const symbols = {\n      measureDrag: {\n        clickable: false,\n        radius: 4,\n        color: this._options.activeColor,\n        weight: 2,\n        opacity: 0.7,\n        fillColor: this._options.activeColor,\n        fillOpacity: 0.5,\n        className: 'layer-measuredrag'\n      },\n      measureArea: {\n        clickable: false,\n        stroke: false,\n        fillColor: this._options.activeColor,\n        fillOpacity: 0.2,\n        className: 'layer-measurearea'\n      },\n      measureBoundary: {\n        clickable: false,\n        color: this._options.activeColor,\n        weight: 2,\n        opacity: 0.9,\n        fill: false,\n        className: 'layer-measureboundary'\n      },\n      measureVertex: {\n        clickable: false,\n        radius: 4,\n        color: this._options.activeColor,\n        weight: 2,\n        opacity: 1,\n        fillColor: this._options.activeColor,\n        fillOpacity: 0.7,\n        className: 'layer-measurevertex'\n      },\n      measureVertexActive: {\n        clickable: false,\n        radius: 4,\n        color: this._options.activeColor,\n        weight: 2,\n        opacity: 1,\n        fillColor: this._options.activeColor,\n        fillOpacity: 1,\n        className: 'layer-measurevertex active'\n      },\n      resultArea: {\n        clickable: true,\n        color: this._options.completedColor,\n        weight: 2,\n        opacity: 0.9,\n        fillColor: this._options.completedColor,\n        fillOpacity: 0.2,\n        className: 'layer-measure-resultarea'\n      },\n      resultLine: {\n        clickable: true,\n        color: this._options.completedColor,\n        weight: 3,\n        opacity: 0.9,\n        fill: false,\n        className: 'layer-measure-resultline'\n      },\n      resultPoint: {\n        clickable: true,\n        radius: 4,\n        color: this._options.completedColor,\n        weight: 2,\n        opacity: 1,\n        fillColor: this._options.completedColor,\n        fillOpacity: 0.7,\n        className: 'layer-measure-resultpoint'\n      }\n    };\n    return symbols[name];\n  }\n}\n","import * as L from 'leaflet';\nimport template from 'lodash/template';\nimport units from './util/units';\nimport * as dom from './util/dom';\nimport measure from './util/measure';\nimport Symbology from './symbology';\n\n// templates\nimport controlTemplate from './templates/control-template.html';\nimport resultsTemplate from './templates/results-template.html';\nimport pointPopupTemplate from './templates/point-popup-template.html';\nimport linePopupTemplate from './templates/line-popup-template.html';\nimport areaPopupTemplate from './templates/area-popup-template.html';\n\n// alias element selector\nconst $ = dom.selectOne;\n\nfunction numberFormat(num) {\n  return num.toLocaleString();\n}\n\nconst templateSettings = {\n  imports: { numberFormat },\n  interpolate: /{{([\\s\\S]+?)}}/g, // mustache\n};\nconst controlTemplateCompiled = template(controlTemplate, templateSettings);\nconst resultsTemplateCompiled = template(resultsTemplate, templateSettings);\nconst pointPopupTemplateCompiled = template(pointPopupTemplate, templateSettings);\nconst linePopupTemplateCompiled = template(linePopupTemplate, templateSettings);\nconst areaPopupTemplateCompiled = template(areaPopupTemplate, templateSettings);\n\nconst MeasureControl = L.Control.extend({\n  _className: 'leaflet-control-measure',\n  options: {\n    units: {},\n    position: 'topright',\n    primaryLengthUnit: 'feet',\n    // secondaryLengthUnit: 'miles',\n    primaryAreaUnit: 'sqfeet',\n    activeColor: '#ABE67E', // base color for map features while actively measuring\n    completedColor: '#74acbd', //'#C8F2BE',  // base color for permenant features generated from completed measure\n    captureZIndex: 10000, // z-index of the marker used to capture measure events\n    popupOptions: {\n      // standard leaflet popup options http://leafletjs.com/reference.html#popup-options\n      className: 'leaflet-measure-resultpopup',\n      autoPanPadding: [10, 10]\n    }\n  },\n\n  initialize: function (options) {\n    L.setOptions(this, options);\n    const { activeColor, completedColor } = this.options;\n    this._symbols = new Symbology({ activeColor, completedColor });\n    this.options.units = Object.assign({}, units, this.options.units);\n  },\n\n  onAdd: function (map) {\n    this._map = map;\n\n    // arrays used to hold simple values\n    this._latlngs = [];\n    this._lengths = [];\n\n    // arrays used to hold leaflet objects\n    // _lengthNotations holds leaflet markers that are made with leaflet divIcons\n    this._lengthNotations = [];\n    // _vertexCircleMarkers holds circleMarkers\n    this._vertexCircleMarkers = [];\n    // _measureFeatures holds the \"measureFeature\" layerGroups (which hold both circle markers and icon markers)\n    this._measureFeatures = [];\n\n    this._initLayout();\n\n    map.on('click', this._collapse, this);\n\n    this._layer = L.layerGroup().addTo(map);\n\n    return this._container;\n  },\n\n  onRemove: function (map) {\n    map.off('click', this._collapse, this);\n\n    map.removeLayer(this._layer);\n  },\n\n  _initLayout: function () {\n    const className = this._className,\n      container = (this._container = L.DomUtil.create('div', `${className} leaflet-bar`));\n    // var $toggle, $start, $cancel, $undo, $finish;\n\n    container.innerHTML = controlTemplateCompiled({\n      model: {\n        className: className\n      }\n    });\n\n    // makes this work on IE touch devices by stopping it from firing a mouseout event when the touch is released\n    container.setAttribute('aria-haspopup', true);\n    L.DomEvent.disableClickPropagation(container);\n    L.DomEvent.disableScrollPropagation(container);\n\n    const $toggle = (this.$toggle = $('.js-toggle', container)); // collapsed content\n    this.$interaction = $('.js-interaction', container); // expanded content\n    const $start = $('.js-start', container); // start button\n    const $cancel = $('.js-cancel', container); // cancel button\n    const $undo = $('.js-undo', container);\n    const $finish = $('.js-finish', container); // finish button\n    this.$startPrompt = $('.js-startprompt', container); // full area with button to start measurment\n    this.$measuringPrompt = $('.js-measuringprompt', container); // full area with all stuff for active measurement\n    this.$startHelp = $('.js-starthelp', container); // \"Start creating a measurement by adding points\"\n    this.$results = $('.js-results', container); // div with coordinate, linear, area results\n    this.$measureTasks = $('.js-measuretasks', container); // active measure buttons container\n\n    this._collapse();\n    this._updateMeasureNotStarted();\n\n    if (!L.Browser.android) {\n      L.DomEvent.on(container, 'mouseenter', this._expand, this);\n      L.DomEvent.on(container, 'mouseleave', this._collapse, this);\n    }\n    L.DomEvent.on($toggle, 'click', L.DomEvent.stop);\n    if (L.Browser.touch) {\n      L.DomEvent.on($toggle, 'click', this._expand, this);\n    } else {\n      L.DomEvent.on($toggle, 'focus', this._expand, this);\n    }\n    L.DomEvent.on($start, 'click', L.DomEvent.stop);\n    L.DomEvent.on($start, 'click', this._startMeasure, this);\n    L.DomEvent.on($cancel, 'click', L.DomEvent.stop);\n    L.DomEvent.on($cancel, 'click', this._finishMeasure, this);\n    L.DomEvent.on($undo, 'click', L.DomEvent.stop);\n    L.DomEvent.on($undo, 'click', this._undoMeasure, this);\n    L.DomEvent.on($finish, 'click', L.DomEvent.stop);\n    L.DomEvent.on($finish, 'click', this._handleMeasureDoubleClick, this);\n  },\n\n  _expand: function () {\n    dom.hide(this.$toggle);\n    dom.show(this.$interaction);\n  },\n\n  _collapse: function () {\n    if (!this._locked) {\n      dom.hide(this.$interaction);\n      dom.show(this.$toggle);\n    }\n  },\n\n  // move between basic states:\n  // measure not started, started/in progress but no points added, in progress and with points\n  _updateMeasureNotStarted: function () {\n    dom.hide(this.$startHelp);\n    dom.hide(this.$results);\n    dom.hide(this.$measureTasks);\n    dom.hide(this.$measuringPrompt);\n    dom.show(this.$startPrompt);\n  },\n\n  _updateMeasureStartedNoPoints: function () {\n    dom.hide(this.$results);\n    dom.show(this.$startHelp);\n    dom.show(this.$measureTasks);\n    dom.hide(this.$startPrompt);\n    dom.show(this.$measuringPrompt);\n  },\n\n  _updateMeasureStartedWithPoints: function () {\n    dom.hide(this.$startHelp);\n    dom.show(this.$results);\n    dom.show(this.$measureTasks);\n    dom.hide(this.$startPrompt);\n    dom.show(this.$measuringPrompt);\n  },\n\n  // get state vars and interface ready for measure\n  _startMeasure: function () {\n    this._locked = true;\n    // new leaflet feature groups are created on _startMeasure\n    this._measureLengths = L.featureGroup().addTo(this._layer);\n    this._measureVertexes = L.featureGroup().addTo(this._layer);\n    this._captureMarker = L.marker(this._map.getCenter(), {\n      clickable: true,\n      zIndexOffset: this.options.captureZIndex,\n      opacity: 0\n    }).addTo(this._layer);\n    this._setCaptureMarkerIcon();\n\n    this._captureMarker\n      .on('mouseout', this._handleMapMouseOut, this)\n      .on('dblclick', this._handleMeasureDoubleClick, this)\n      .on('click', this._handleMeasureClick, this);\n\n    this._map\n      .on('mousemove', this._handleMeasureMove, this)\n      .on('mouseout', this._handleMapMouseOut, this)\n      .on('move', this._centerCaptureMarker, this)\n      .on('resize', this._setCaptureMarkerIcon, this);\n\n    L.DomEvent.on(this._container, 'mouseenter', this._handleMapMouseOut, this);\n\n    this._updateMeasureStartedNoPoints();\n\n    this._map.fire('measurestart', null, false);\n  },\n\n  // remove the last clicked point and notation\n  _undoMeasure: function () {\n    // remove last simple coordinate from _latlngs\n    this._latlngs = this._latlngs.slice(0, -1);\n    // remove the last length notation\n    this._removeLastLengthNotation();\n    // remove the last point\n    this._removeLastVertex();\n    if (this._latlngs.length > 0) {\n      this._addMeasureArea(this._latlngs);\n      this._addMeasureBoundary(this._latlngs);\n      this._updateResults();\n    }\n    // if you undo when there are no points put down, it changes the widget back to the original info\n    if (this._latlngs.length === 0) {\n      this._updateMeasureStartedNoPoints();\n    }\n  },\n\n  // return to state with no measure in progress, undo `this._startMeasure`\n  _finishMeasure: function (isComplete) {\n    let shouldDeleteLengths;\n    if (isComplete === true) {\n      shouldDeleteLengths = false;\n    } else {\n      shouldDeleteLengths = true;\n    }\n    // var model = _.extend({}, this._resultsModel, {\n    const model = Object.assign({}, this._resultsModel, {\n      points: this._latlngs\n    });\n\n    this._locked = false;\n\n    L.DomEvent.off(this._container, 'mouseover', this._handleMapMouseOut, this);\n\n    this._clearMeasure(shouldDeleteLengths);\n\n    this._captureMarker\n      .off('mouseout', this._handleMapMouseOut, this)\n      .off('dblclick', this._handleMeasureDoubleClick, this)\n      .off('click', this._handleMeasureClick, this);\n\n    this._map\n      .off('mousemove', this._handleMeasureMove, this)\n      .off('mouseout', this._handleMapMouseOut, this)\n      .off('move', this._centerCaptureMarker, this)\n      .off('resize', this._setCaptureMarkerIcon, this);\n\n    this._layer.removeLayer(this._measureVertexes).removeLayer(this._captureMarker);\n    this._measureVertexes = null;\n\n    this._updateMeasureNotStarted();\n    this._collapse();\n\n    this._map.fire('measurefinish', model, false);\n  },\n\n  // clear all running measure data\n  _clearMeasure: function (shouldDeleteLengths) {\n    this._latlngs = [];\n    this._resultsModel = null;\n    if (shouldDeleteLengths) {\n      this._measureLengths.clearLayers();\n    }\n    this._measureVertexes.clearLayers();\n    if (this._measureDrag) {\n      this._layer.removeLayer(this._measureDrag);\n    }\n    if (this._measureArea) {\n      this._layer.removeLayer(this._measureArea);\n    }\n    if (this._measureBoundary) {\n      this._layer.removeLayer(this._measureBoundary);\n    }\n    this._measureDrag = null;\n    this._measureArea = null;\n    this._measureBoundary = null;\n  },\n\n  // centers the event capture marker\n  _centerCaptureMarker: function () {\n    this._captureMarker.setLatLng(this._map.getCenter());\n  },\n\n  // set icon on the capture marker\n  _setCaptureMarkerIcon: function () {\n    this._captureMarker.setIcon(\n      L.divIcon({\n        iconSize: this._map.getSize().multiplyBy(2)\n      })\n    );\n  },\n\n  // format measurements to nice display string based on units in options\n  // `{ lengthDisplay: '100 Feet (0.02 Miles)', areaDisplay: ... }`\n  _getMeasurementDisplayStrings: function (measurement) {\n    // console.log(\n    //   '_getMeasurementDisplayStrings units:',\n    //   this.options.units,\n    //   'primaryLengthUnit:',\n    //   this.options.primaryLengthUnit,\n    //   'primaryAreaUnit:',\n    //   this.options.primaryAreaUnit\n    // );\n    const unitDefinitions = this.options.units;\n\n    return {\n      lengthDisplay: buildDisplay(\n        measurement.length,\n        this.options.primaryLengthUnit,\n        this.options.secondaryLengthUnit,\n        this.options.decPoint,\n        this.options.thousandsSep\n      ),\n      areaDisplay: buildDisplay(\n        measurement.area,\n        this.options.primaryAreaUnit,\n        this.options.secondaryAreaUnit,\n        this.options.decPoint,\n        this.options.thousandsSep\n      )\n    };\n\n    function buildDisplay(val, primaryUnit, secondaryUnit, decPoint, thousandsSep) {\n      let display;\n      if (primaryUnit && unitDefinitions[primaryUnit]) {\n        display = formatMeasure(val, unitDefinitions[primaryUnit], decPoint, thousandsSep);\n        if (secondaryUnit && unitDefinitions[secondaryUnit]) {\n          const formatted = formatMeasure(\n            val,\n            unitDefinitions[secondaryUnit],\n            decPoint,\n            thousandsSep\n          );\n          display = `${display} (${formatted})`;\n        } else {\n          display = formatMeasure(val, null, decPoint, thousandsSep);\n        }\n        return display;\n      }\n      return formatMeasure(val, null, decPoint, thousandsSep);\n    }\n\n    function formatMeasure(val, unit, decPoint, thousandsSep) {\n      const unitDisplays = {\n        acres: 'Acres',\n        feet: 'Feet',\n        kilometers: 'Kilometers',\n        hectares: 'Hectares',\n        meters: 'Meters',\n        miles: 'Miles',\n        sqfeet: 'Sq Feet',\n        sqmeters: 'Sq Meters',\n        sqmiles: 'Sq Miles',\n      };\n\n      // const u = Object.assign({ factor: 1, decimals: 0 }, unit);\n      // const formattedNumber = numberFormat(\n      //   val * u.factor,\n      //   u.decimals,\n      //   '.',\n      //   ','\n      // );\n\n      const { display } = unit;\n      const label = unitDisplays[display] || display;\n\n      return [formattedNumber, label].join(' ');\n    }\n  },\n\n  // format measurements to nice SHORTER display string based on units in options\n  // `{ lengthDisplay: '100 ft', areaDisplay: ... }`\n  _getShorterMeasurementDisplayStrings: function (measurement) {\n    // console.log(\n    //   '_getShorterMeasurementDisplayStrings measurement.length:',\n    //   measurement.length,\n    //   'this.options.primaryLengthUnit:',\n    //   this.options.primaryLengthUnit,\n    //   'secondaryLengthUnit:',\n    //   this.options.secondaryLengthUnit\n    // );\n    const unitDefinitions = this.options.units;\n    return {\n      lengthDisplay: buildDisplay(\n        measurement.length,\n        this.options.primaryLengthUnit,\n        this.options.secondaryLengthUnit,\n        '.',\n        this.options.thousandsSep\n      ),\n      areaDisplay: buildDisplay(\n        measurement.area,\n        this.options.primaryAreaUnit,\n        this.options.secondaryAreaUnit,\n        this.options.decPoint,\n        this.options.thousandsSep\n      )\n    };\n\n    function buildDisplay(val, primaryUnit, secondaryUnit, decPoint, thousandsSep) {\n      let display;\n      if (primaryUnit) {\n        display = formatMeasure(val, unitDefinitions[primaryUnit], decPoint, thousandsSep);\n        if (secondaryUnit && unitDefinitions[secondaryUnit]) {\n          display =\n            display +\n            ' (' +\n            formatMeasure(val, unitDefinitions[secondaryUnit], decPoint, thousandsSep) +\n            ')';\n        }\n      } else {\n        display = formatMeasure(val, null, decPoint, thousandsSep);\n      }\n      return display;\n    }\n\n    function formatMeasure(val, unit, decPoint, thousandsSep) {\n      const u = Object.assign({ factor: 1, decimals: 2 }, unit);\n      const formattedNumber = numberFormat(\n        val * u.factor,\n        u.decimals,\n        '.',\n        ','\n      );\n      return formattedNumber;\n    }\n  },\n\n  // update results area of dom with calced measure from `this._latlngs`\n  _updateResults: function () {\n    const calced = measure(this._latlngs);\n    const model = (this._resultsModel = Object.assign(\n      {},\n      calced,\n      this._getShorterMeasurementDisplayStrings(calced),\n      {\n        pointCount: this._latlngs.length,\n        points: this._latlngs,\n        lengths: this._lengths\n      }\n    ));\n    // console.log('_updateResults is running, calced:', calced, 'model:', model);\n    this.$results.innerHTML = resultsTemplateCompiled({ model });\n  },\n\n  // mouse move handler while measure in progress\n  // adds floating measure marker under cursor\n  _handleMeasureMove: function (evt) {\n    if (!this._measureDrag) {\n      this._measureDrag = L.circleMarker(evt.latlng, this._symbols.getSymbol('measureDrag')).addTo(\n        this._layer\n      );\n    } else {\n      this._measureDrag.setLatLng(evt.latlng);\n    }\n    this._measureDrag.bringToFront();\n  },\n\n  // handler for both double click and clicking finish button\n  // do final calc and finish out current measure, clear dom and internal state, add permanent map features\n  _handleMeasureDoubleClick: function () {\n    const latlngs = this._latlngs;\n\n    const measureFeature = L.layerGroup();\n    measureFeature.addTo(this._layer);\n    this._measureFeatures.push(measureFeature);\n    this._measureLengths.removeFrom(this._layer);\n    this._measureLengths.addTo(measureFeature);\n    this._finishMeasure(true);\n\n    const lengths = [];\n    for (let i = 0; i < this._lengths.length; i++) {\n      lengths[i] = this._lengths[i];\n    }\n\n    if (!latlngs.length) {\n      return;\n    }\n\n    if (latlngs.length > 2) {\n      latlngs.push((latlngs || [])[0]);\n      const count = latlngs.length;\n      const previousLatLng = latlngs[count - 2];\n      const lastLatLng = latlngs[count - 1];\n      const bounds = L.latLngBounds(previousLatLng, lastLatLng);\n      const center = bounds.getCenter();\n      const pair = [previousLatLng, lastLatLng];\n      const calced2 = measure(pair);\n      const newNotation = this._addNewLengthNotation(center, calced2);\n      newNotation.addTo(this._measureLengths);\n      const j = this._lengths.length;\n      lengths[j - 1] = this._lengths[j - 1];\n    }\n\n    const calced = measure(latlngs);\n    let resultFeature;\n    let popupContent;\n    let popupContainer;\n    let zoomLink;\n    let deleteLink;\n\n    if (latlngs.length === 1) {\n      resultFeature = L.circleMarker(latlngs[0], this._symbols.getSymbol('resultPoint'));\n      popupContent = pointPopupTemplateCompiled({\n        model: calced\n      });\n    } else if (latlngs.length === 2) {\n      resultFeature = L.polyline(latlngs, this._symbols.getSymbol('resultLine'));\n      popupContent = linePopupTemplateCompiled({\n        model: Object.assign({}, calced, this._getShorterMeasurementDisplayStrings(calced))\n      });\n    } else {\n      resultFeature = L.polygon(latlngs, this._symbols.getSymbol('resultArea'));\n      const resultsModel = Object.assign(\n        {},\n        calced,\n        this._getShorterMeasurementDisplayStrings(calced),\n        {\n          pointCount: latlngs.length,\n          points: latlngs,\n          lengths: this._lengths\n        }\n      );\n      popupContent = areaPopupTemplateCompiled({\n        model: resultsModel,\n      });\n    }\n\n    // clear out arrays holding values\n    this._lengths = [];\n    this._vertexCircleMarkers = [];\n\n    popupContainer = L.DomUtil.create('div', '');\n    popupContainer.innerHTML = popupContent;\n\n    zoomLink = $('.js-zoomto', popupContainer);\n    if (zoomLink) {\n      L.DomEvent.on(zoomLink, 'click', L.DomEvent.stop);\n      L.DomEvent.on(\n        zoomLink,\n        'click',\n        function () {\n          if (resultFeature.getBounds) {\n            this._map.fitBounds(resultFeature.getBounds(), {\n              padding: [20, 20],\n              maxZoom: 17\n            });\n          } else if (resultFeature.getLatLng) {\n            this._map.panTo(resultFeature.getLatLng());\n          }\n        },\n        this\n      );\n    }\n\n    deleteLink = $('.js-deletemarkup', popupContainer);\n    if (deleteLink) {\n      L.DomEvent.on(deleteLink, 'click', L.DomEvent.stop);\n      L.DomEvent.on(\n        deleteLink,\n        'click',\n        function () {\n          const i = this._measureFeatures.indexOf(measureFeature);\n          const selectedMeasureFeature = this._measureFeatures[i];\n          selectedMeasureFeature.removeFrom(this._layer);\n        },\n        this\n      );\n    }\n\n    resultFeature.addTo(measureFeature);\n    resultFeature.bindPopup(popupContainer, this.options.popupOptions);\n    if (resultFeature.getBounds) {\n      resultFeature.openPopup(resultFeature.getBounds().getCenter());\n    } else if (resultFeature.getLatLng) {\n      resultFeature.openPopup(resultFeature.getLatLng());\n    }\n  },\n  // handle map click during ongoing measurement\n  // add new clicked point, update measure layers and results ui\n  _handleMeasureClick: function (evt) {\n    let latlng = this._map.mouseEventToLatLng(evt.originalEvent), // get actual latlng instead of the marker's latlng from originalEvent\n      lastClick = (this._latlngs || []).slice(-1)[0],\n      firstClick = (this._latlngs || [])[0],\n      vertexSymbol = this._symbols.getSymbol('measureVertex');\n\n    if (!lastClick || !latlng.equals(lastClick)) {\n      // skip if same point as last click, happens on `dblclick`\n      this._latlngs.push(latlng);\n      this._addMeasureArea(this._latlngs);\n      this._addMeasureBoundary(this._latlngs);\n\n      this._measureVertexes.eachLayer(function (layer) {\n        layer.setStyle(vertexSymbol);\n        // reset all vertexes to non-active class - only last vertex is active\n        // `layer.setStyle({ className: 'layer-measurevertex'})` doesn't work. https://github.com/leaflet/leaflet/issues/2662\n        // set attribute on path directly\n        if (layer._path) {\n          layer._path.setAttribute('class', vertexSymbol.className);\n        }\n      });\n\n      this._addNewVertex(latlng);\n      // if there is a first click\n      if (firstClick) {\n        // console.log('_handleMeasureClick is running, firstClick section');\n        const count = this._latlngs.length;\n        const previousLatLng = this._latlngs[count - 2];\n        // console.log('previousLatLng:', previousLatLng);\n        const bounds = L.latLngBounds(previousLatLng, latlng);\n        const center = bounds.getCenter();\n        const pair = [previousLatLng, latlng];\n        // console.log('calc:', calc);\n        const calced = measure(pair);\n        this._addNewLengthNotation(center, calced).addTo(this._measureLengths);\n        // this._addNewLengthNotation(center, calced).addTo(this._measureLengths2);\n      }\n      if (this._measureBoundary) {\n        this._measureBoundary.bringToFront();\n      }\n      this._measureVertexes.bringToFront();\n    }\n    this._updateResults();\n    this._updateMeasureStartedWithPoints();\n  },\n\n  _addNewLengthNotation: function (latlng, calced) {\n    const answer = this._getShorterMeasurementDisplayStrings(calced);\n    const myIcon = L.divIcon({\n      className: 'my-div-icon',\n      html: answer.lengthDisplay\n    });\n    // you can set .my-div-icon styles in CSS\n    const marker = L.marker(latlng, {\n      icon: myIcon\n    });\n    this._lengths.push(answer.lengthDisplay);\n    this._lengthNotations.push(marker);\n    return marker;\n  },\n\n  // remove last length notation (when undo is clicked)\n  _removeLastLengthNotation: function () {\n    const i = this._lengthNotations.length;\n    // _lengthNotations is a simple array holding leaflet markers of leaflet divIcons\n    // it is used here to remove a marker from the feature group that is on the map\n    if (this._lengthNotations.length > 0) {\n      // _measureLengths is the leaflet feature group holding the leaflet markers of leaflet divIcons\n      this._lengthNotations[i - 1].removeFrom(this._measureLengths);\n    }\n    // remove the icon-marker from _lengthNotations, and the simple number from _lengths\n    this._lengthNotations = this._lengthNotations.slice(0, -1);\n    this._lengths = this._lengths.slice(0, -1);\n  },\n\n  // handle map mouse out during ongoing measure\n  // remove floating cursor vertex from map\n  _handleMapMouseOut: function () {\n    if (this._measureDrag) {\n      this._layer.removeLayer(this._measureDrag);\n      this._measureDrag = null;\n    }\n  },\n\n  // add various measure graphics to map - vertex, area, boundary\n  _addNewVertex: function (latlng) {\n    const marker = L.circleMarker(latlng, this._symbols.getSymbol('measureVertexActive'));\n    this._vertexCircleMarkers.push(marker);\n    marker.addTo(this._measureVertexes);\n  },\n\n  // remove last vertex (when undo is clicked)\n  _removeLastVertex: function () {\n    const i = this._vertexCircleMarkers.length;\n    if (this._vertexCircleMarkers.length > 0) {\n      this._vertexCircleMarkers[i - 1].removeFrom(this._measureVertexes);\n    }\n    this._vertexCircleMarkers = this._vertexCircleMarkers.slice(0, -1);\n  },\n\n  _addMeasureArea: function (latlngs) {\n    if (latlngs.length < 3) {\n      if (this._measureArea) {\n        this._layer.removeLayer(this._measureArea);\n        this._measureArea = null;\n      }\n      return;\n    }\n    if (!this._measureArea) {\n      this._measureArea = L.polygon(latlngs, this._symbols.getSymbol('measureArea')).addTo(\n        this._layer\n      );\n    } else {\n      this._measureArea.setLatLngs(latlngs);\n    }\n  },\n\n  _addMeasureBoundary: function (latlngs) {\n    if (latlngs.length < 2) {\n      if (this._measureBoundary) {\n        this._layer.removeLayer(this._measureBoundary);\n        this._measureBoundary = null;\n      }\n      return;\n    }\n    if (!this._measureBoundary) {\n      this._measureBoundary = L.polyline(latlngs, this._symbols.getSymbol('measureBoundary')).addTo(\n        this._layer\n      );\n    } else {\n      this._measureBoundary.setLatLngs(latlngs);\n    }\n  },\n});\n\nexport default MeasureControl;\n"],"names":["acres","factor","display","decimals","feet","kilometers","hectares","meters","miles","sqfeet","sqmeters","sqmiles","hide","el","setAttribute","show","removeAttribute","measure","latlngs","length","const","path","map","latlng","lat","lng","polyline","Polyline","polygon","Polygon","toGeoJSON","units","area","DEFAULT_OPTIONS","activeColor","completedColor","Symbology","options","this","_options","L","extend","getSymbol","name","measureDrag","clickable","radius","color","weight","opacity","fillColor","fillOpacity","className","measureArea","stroke","measureBoundary","fill","measureVertex","measureVertexActive","resultArea","resultLine","resultPoint","$","selector","document","querySelector","numberFormat","num","toLocaleString","templateSettings","imports","interpolate","controlTemplateCompiled","template","resultsTemplateCompiled","pointPopupTemplateCompiled","linePopupTemplateCompiled","areaPopupTemplateCompiled","L.Control","_className","position","primaryLengthUnit","primaryAreaUnit","captureZIndex","popupOptions","autoPanPadding","initialize","L.setOptions","_symbols","Object","assign","onAdd","_map","_latlngs","_lengths","_lengthNotations","_vertexCircleMarkers","_measureFeatures","_initLayout","on","_collapse","_layer","L.layerGroup","addTo","_container","onRemove","off","removeLayer","container","L.DomUtil","create","innerHTML","model","L.DomEvent","disableClickPropagation","disableScrollPropagation","$toggle","$interaction","$start","$cancel","$undo","$finish","$startPrompt","$measuringPrompt","$startHelp","$results","$measureTasks","_updateMeasureNotStarted","L.Browser","android","_expand","stop","touch","_startMeasure","_finishMeasure","_undoMeasure","_handleMeasureDoubleClick","dom.hide","dom.show","_locked","_updateMeasureStartedNoPoints","_updateMeasureStartedWithPoints","_measureLengths","L.featureGroup","_measureVertexes","_captureMarker","L.marker","getCenter","zIndexOffset","_setCaptureMarkerIcon","_handleMapMouseOut","_handleMeasureClick","_handleMeasureMove","_centerCaptureMarker","fire","slice","_removeLastLengthNotation","_removeLastVertex","_addMeasureArea","_addMeasureBoundary","_updateResults","isComplete","let","shouldDeleteLengths","_resultsModel","points","_clearMeasure","clearLayers","_measureDrag","_measureArea","_measureBoundary","setLatLng","setIcon","L.divIcon","iconSize","getSize","multiplyBy","_getMeasurementDisplayStrings","measurement","unitDefinitions","lengthDisplay","buildDisplay","secondaryLengthUnit","decPoint","thousandsSep","areaDisplay","secondaryAreaUnit","val","primaryUnit","secondaryUnit","formatMeasure","unit","formattedNumber","join","_getShorterMeasurementDisplayStrings","u","calced","pointCount","lengths","evt","L.circleMarker","bringToFront","measureFeature","push","removeFrom","i","count","previousLatLng","lastLatLng","center","L.latLngBounds","calced2","_addNewLengthNotation","j","resultFeature","popupContent","popupContainer","zoomLink","deleteLink","L.polyline","L.polygon","resultsModel","getBounds","fitBounds","padding","maxZoom","getLatLng","panTo","indexOf","bindPopup","openPopup","mouseEventToLatLng","originalEvent","lastClick","firstClick","vertexSymbol","equals","eachLayer","layer","setStyle","_path","_addNewVertex","answer","myIcon","html","marker","icon","setLatLngs"],"mappings":"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"}